version: "3.1"
services:
  config-service:
     image: bkake/config-service
     restart: always
     ports:
       - "8888:8888"
     env_file:
       - ./gitconf.env
     networks:
       - backend

  discovery:
    image: bkake/discovery-service
    restart: always
    ports:
      - "8761:8761"
    depends_on:
      - config-service
    networks:
      - backend
    env_file:
      - ./config.env

  category-service:
    image: bkake/category-service
    restart: always
    ports:
      - "8181:8181"
    depends_on:
      - config-service
      - discovery
      - zipkin
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./zipkin.env
      - ./config.env

  author-service:
    image: bkake/author-service
    restart: always
    ports:
      - "8282:8282"
    depends_on:
      - config-service
      - discovery
      - zipkin
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./zipkin.env
      - ./config.env

  new-service:
    image: bkake/new-service
    restart: always
    ports:
      - "8383:8383"
    depends_on:
      - config-service
      - discovery
      - zipkin
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./zipkin.env
      - ./config.env

  gateway:
    image: bkake/gateway-service
    restart: always
    ports:
      - "8762:8762"
    depends_on:
      - config-service
      - discovery
      - zipkin
      - category-service
      - author-service
      - new-service
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./zipkin.env
      - ./config.env

  zipkin:
    image: bkake/zipkin-service
    restart: always
    ports:
      - "9411:9411"
    depends_on:
      - config-service
      - discovery
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./config.env

  hystrix-dashboard:
    image: bkake/hystrix-dashboard
    restart: always
    ports:
      - "8763:8763"
    depends_on:
      - config-service
      - discovery
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./config.env

  admin-dashboard:
    image: bkake/admin-dashboard
    restart: always
    ports:
      - "8764:8764"
    depends_on:
      - config-service
      - discovery
    networks:
      - backend
    env_file:
      - ./eureka.env
      - ./config.env

#  security-service:
#    image: bkake/security-service
#    restart: always
#    ports:
#      - "9999:9999"
#    depends_on:
#      - config-service
#      - discovery
#    networks:
#      - backend
#    env_file:
#      - ./eureka.env
#      - ./config.env

#  postgres:
#    image: postgres
#    volumes:
#      - postgres_data:/var/lib/postgresql/data
#    networks:
#      - backend
#    environment:
#      POSTGRES_DB: keycloak
#      POSTGRES_USER: keycloak
#      POSTGRES_PASSWORD: password
#
#  keycloak:
#    image: jboss/keycloak
#    ports:
#      - "8180:8080"
#    depends_on:
#      - postgres
#    networks:
#      - backend
#    environment:
#      DB_VENDOR: POSTGRES
#      DB_ADDR: postgres
#      DB_DATABASE: keycloak
#      DB_USER: keycloak
#      DB_PASSWORD: password
#      KEYCLOAK_USER: admin
#      KEYCLOAK_PASSWORD: Pa55w0rd
#      # Uncomment the line below if you want to specify JDBC parameters. The parameter below is just an example, and it shouldn't be used in production without knowledge. It is highly recommended that you read the PostgreSQL JDBC driver documentation in order to use it.
#      #JDBC_PARAMS: "ssl=true"


networks:
  backend:
    driver: bridge

#volumes:
#  postgres_data:
#      driver: local